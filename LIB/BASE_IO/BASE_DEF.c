// Header: 
// File Name: 
// Author: 
// Date: 

/******************************************************************************/
//Start File
#include "BASE_DEF.h"
#include <stdbool.h>
#include <string.h>
#include "stm32f4xx_hal_crc.h"
#include "crypto.h"

//#define DWT_CONTROL *(volatile unsigned long *)0xE0001000
#define DWT_CONTROL *(volatile unsigned long *)DWT_BASE
#define SCB_DEMCR   *(volatile unsigned long *)0xE000EDFC
extern CRC_HandleTypeDef hcrc;

//void DWT_Init(void);
//void Delay_uS(uint32_t uS); // DelayMicro

const uint8_t message[] = {"Message 12345678"};
volatile const uint8_t _LMessage[256] =
	{
	 'L','o','n','g',' ','M','e','s','s','a','g','e',' ','D','E','F'	//0x00	
	,'0','1','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x10	
	,'0','2','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x20	
	,'0','3','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x30	
	,'0','4','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x40	
	,'0','5','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x50	
	,'0','6','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x60	
	,'0','7','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x70	
	,'0','8','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x80	
	,'0','9','_','3','/','E','n','d',' ','M','e','s','s','a','g','e'	//0x90	
	,'0','A','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0xA0	
	,'0','B','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0xB0	
	,'0','C','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0xC0	
	,'0','D','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0xD0	
	,'0','E','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0xE0	
	,'0','F','_','3','4','5','6','7','8','9','A','B','C','D','E','F'    //0xF0
};

const uint8_t _UMessage[512] =
	{
	 'L','o','n','g',' ','M','e','s','s','a','g','e',' ','D','E','F'	//0x000	
	,'0','1','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x010	
	,'0','2','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x020	
	,'0','3','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x030	
	,'0','4','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x040	
	,'0','5','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x050	
	,'0','6','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x060	
	,'0','7','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x070	
	,'0','8','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x080	
	,'0','9','_','3','/','E','n','d',' ','M','e','s','s','a','g','e'	//0x090	
	,'0','A','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x0A0	
	,'0','B','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x0B0	
	,'0','C','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x0C0	
	,'0','D','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x0D0	
	,'0','E','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x0E0	
	,'0','F','_','3','4','5','6','7','8','9','A','B','C','D','E','F'    //0x0F0
	,'1','0','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x100	
	,'1','1','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x110	
	,'1','2','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x120	
	,'1','3','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x130	
	,'1','4','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x140	
	,'1','5','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x150	
	,'1','6','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x160	
	,'1','7','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x170	
	,'1','8','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x180	
	,'1','9','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x190	
	,'1','A','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x1A0	
	,'1','B','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x1B0	
	,'1','C','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x1C0	
	,'1','D','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x1D0	
	,'1','E','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x1E0	
	,'1','F','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x1F0	
//	,'1','1','_','3','4','5','6','7','8','9','A','B','C','D','E','F'	//0x200	
};

uint16_t _UMessageLenght = sizeof( _UMessage);
/******************************************************************************/

uint8_t EncryptedMessage[] =
  {
    0x45, 0x4E, 0x4F, 0xE2, 0x40, 0xBA, 0xF4, 0xD9, 0xED, 0xEA, 0x65, 0x79, 0xB4, 0xCF, 0x8D, 0xE4, 0x41, 0x3E,
    0x56, 0x78, 0xAC, 0x5C, 0x47, 0x3F, 0x22, 0x1F, 0x16, 0xCB, 0xBC, 0xFC, 0x9E, 0xB7, 0x31, 0x96, 0x37, 0x83,
    0x3A, 0xFE, 0x46, 0x51, 0x75, 0x27, 0xE6, 0x6F, 0x66, 0x3E, 0xC9, 0xB9, 0xB4, 0x7C, 0x1E, 0xB8, 0xF3, 0xB1,
    0xBA, 0x87, 0xF6, 0x12, 0x0F, 0xCA, 0xD7, 0x63, 0xC0, 0x8A, 0x86, 0xE3, 0xF6, 0x1C, 0x61, 0x5A, 0x01, 0xDD,
    0x3F, 0x97, 0xC9, 0x2A, 0x55, 0x0B, 0x46, 0x25, 0xE6, 0xAE, 0x87, 0x72, 0x08, 0xA8, 0x49, 0x10, 0xED, 0xE0,
    0xAB, 0xD5, 0x73, 0xE4, 0xF2, 0x74, 0x01, 0xCE, 0x7B, 0xAA, 0xD2, 0xC2, 0x86, 0xC1, 0x64, 0x8D, 0xD7, 0x63,
    0xA4, 0x7C, 0xDC, 0xA8, 0x21, 0x93, 0x12, 0x0D, 0xC3, 0x8D, 0xD9, 0x59, 0x97, 0x80, 0xC1, 0xC7, 0x8F, 0x0D,
    0x3B, 0x16, 0x3C, 0xE2, 0x2F, 0xB4, 0x52, 0x8C, 0x0C, 0x15, 0xE5, 0x98, 0x81, 0xEF, 0xB4, 0xD3, 0x5E, 0x72,
    0xC8, 0x89, 0x64, 0xBE, 0x54, 0xEC, 0xFB, 0x38, 0x85, 0xB4, 0x62, 0x39, 0xA6, 0xCC, 0xC4, 0x68, 0x0C, 0xDF,
    0xA4, 0x5A, 0x9D, 0x34, 0x31, 0x2A, 0x0C, 0x3B, 0x52, 0xCF, 0x13, 0xF3, 0xE8, 0x5A, 0x0C, 0xEA, 0x41, 0x94,
    0xD5, 0x25, 0xAA, 0xC0, 0x2B, 0xC8, 0xB2, 0x04, 0xA6, 0xCD, 0x26, 0xF6, 0x02, 0x98, 0x89, 0x79, 0x62, 0x76,
    0x76, 0xEF, 0xF4, 0x3C, 0x09, 0x16, 0x4B, 0x1A, 0x9C, 0xCA, 0x4F, 0x42, 0x9A, 0xA2, 0x4B, 0x98, 0xF8, 0xFF,
    0xBE, 0xBF, 0xE4, 0xA0, 0x0F, 0xEB, 0xC1, 0xDB, 0x69, 0x4D, 0x93, 0x16, 0x5F, 0x3D, 0xBF, 0xA1, 0xD8, 0x4D,
    0x05, 0x21, 0xD1, 0xB4, 0xDA, 0x13, 0x4C, 0x27, 0x8E, 0xB2, 0x4F, 0x57, 0x07, 0xCC, 0xA6, 0xA1, 0x0F, 0x52,
    0xD5, 0x72, 0x16, 0x9D
  };


const uint8_t _AES_Key[] =    {"0123456789ABCDEF"};

void DWT_Init(void)

{
    SCB_DEMCR |= CoreDebug_DEMCR_TRCENA_Msk; // разрешаем использовать счётчик
	DWT_CONTROL |= DWT_CTRL_CYCCNTENA_Msk;   // запускаем счётчик
}

void Delay_uS(uint32_t uS) // DelayMicro
{
    uint32_t uS_count_tic =  uS * (SystemCoreClock / 1000000);
	uint32_t _cyccnt = DWT->CYCCNT;
    DWT->CYCCNT = 0U; // обнуляем счётчик
    while(DWT->CYCCNT < uS_count_tic);
	DWT->CYCCNT = _cyccnt + uS_count_tic;
}


//uint32_t CalcCRC(const uint8_t *pBuf, const uint16_t lenght)
//{
//// uint32_t	bufCRC;
////	memset((uint8_t*)bufCRC, 0, sizeof(bufCRC));
//////	hcrc.Instance->CR |= CRC_CR_RESET;
//////	uint8_t *pCRC = (uint8_t*)bufCRC;
//////	memcpy(pCRC, pBuf, lenght);
////	memcpy((uint8_t*)&bufCRC, pBuf, lenght);
////	return HAL_CRC_Calculate(&hcrc, bufCRC, sizeof(bufCRC));
//	uint16_t count = 0;
//	__HAL_RCC_CRC_CLK_ENABLE();
//	__HAL_CRC_DR_RESET(&hcrc);
//	CRC->DR = 0xFFFFFFFF;
//	uint16_t r_div = lenght % 4;
//	volatile uint16_t ln = lenght - r_div;
//	ln = ln*4;
//	for(; count < ln; count = count + 4)
//	{
//		CRC->DR = (uint32_t)(*pBuf + count);
//	}
//	uint32_t b;
//	if(r_div)
//	{
//		memcpy((uint8_t*)&b, (uint8_t*)&pBuf[count], r_div);
//		CRC->DR = b;
//	}
//	b = CRC->DR;
//	__HAL_RCC_CRC_CLK_DISABLE();
//	return b;
//}






//End File
